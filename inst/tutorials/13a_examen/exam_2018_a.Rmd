---
title: "Examen de janvier 2018 : Version A"
subtitle: "Traitement des données I"
author: "Guyliann Engels & Philippe Grosjean"
output:
  learnr::tutorial
tutorial:
  id: "sdd1.13a"
  version: 0.4.0
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(knitr)
SciViews::R()

options(tutorial.event_recorder = BioDataScience::record_sdd)
tutorial_options(exercise.checker = BioDataScience::checker_sdd)
tutorial_options(exercise.timelimit = 60)
tutorial_options(exercise.cap = "Code R")
knitr::opts_chunk$set(echo = FALSE, comment = NA)

library(BioDataScience)
#dataset

```

```{r, echo=FALSE}
fixedRow(
  column(9, div(
    img(src = 'images/BioDataScience-128.png', align = "left"),
    h1("Science des données biologiques"),
    "Réalisé par le service d'Écologie numérique des Milieux aquatiques, Université de Mons (Belgique)"
  )),
  column(3, div(
    textInput("user", "Utilisateur :", ""),
    textInput("email", "Email :", "")
  ))
)
textOutput("user") # This is newer shown, but required to trigger an event!
textOutput("email") # Idem!
```

```{r, context="server"}
output$user <- renderText({BioDataScience::user_name(input$user);""})
output$email <- renderText({BioDataScience::user_email(input$email);""})
updateTextInput(session, "user", value = BioDataScience::user_name())
updateTextInput(session, "email", value = BioDataScience::user_email())
```

## Préambule

Durant l'ensemble du cours, vous avez été confronté à des learnr afin de vérifier l'acquisition de différents concepts lié à la science des données biologiques. Votre examen vous est proposé sous le même format. 

Ce questionnaire comprend 16 questions dont 15 questions à choix multiples avec la cotation suivantes :

- bonne réponse  +1
- mauvaise réponse -1


![](images/attention.jpg)

**Ne vous trompez pas dans votre adresse mail et votre identifiant Github**

**N'oubliez pas de soumettre votre réponse après chaque exercice**

> Conformément au RGPD ([Règlement Général sur la Protection des Données](https://ec.europa.eu/info/law/law-topic/data-protection/reform/rules-business-and-organisations/principles-gdpr_fr)), nous sommes tenus de vous informer de ce que vos résultats seront collecté afin de suivre votre progression. **Les données seront enregistrées au nom de l'utilisateur apparaissant en haut de cette page. Corrigez si nécessaire !** En utilisant ce tutoriel, vous marquez expressément votre accord pour que ces données puissent être collectées par vos enseignants et utilisées pour vous aider et vous évaluer. Après avoir été anonymisées, ces données pourront également servir à des études globales dans un cadre scientifique et/ou éducatif uniquement.

## 1. Calcul de probabilités sur tableau 

Sur base d'un questionnaire lié à l'indice de masse corporelle et l'activité physique, les chercheurs ont classé les individus en différents niveaux d'activité physique et d'IMC. Ils obtiennent le tableau suivant : 

```{r}
imc <- data.frame("Sous-poids" = sample(20:70, size = 3), 
                     "Normal" = sample(30:80, size = 3), 
                     "Surpoids" = sample(10:60, size = 3),
                     "Obésité" = sample(0:50, size = 3),
                     row.names = c("Activité physique occasionnelle", "Activité physique régulière", "Activité physique de haut niveau"))
knitr::kable(imc, caption = "Tableau")
```

Afin de vous aider dans vos réflexions, voici la somme des lignes et des colonnes

```{r, echo=TRUE}
# Somme des lignes
(rowSums(imc) -> x)
# Somme des colonnes
(colSums(imc) -> y)
# Somme totale d'observations
sum(x)
sum(y)
```

Vous avez à votre disposition une zone de code.

```{r proba_imc_cal, exercise = TRUE}

```

Répondez aux questions ci-dessous sur base du tableau proposé ci-dessus :

```{r qeq_proba_imc}
quiz(question("Quelle est la probabilité d'avoir une activité physique de haut niveau ?",
              answer(sprintf("$%s$", 
                             round((sum(imc[3, ])/sum(imc[1:3, ])), 2)), correct = TRUE),
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ])/sum(imc[1:2, ])), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[3, ])/sum(imc[1:2, ])), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[2:3, ])/sum(imc[1:2, ])), 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE),
     question("Quelle est la probabilité d'avoir une activité physique régulière ou d'être obèse ?",
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ]) + sum(imc[ ,4]) - imc[2,4]) / sum(imc[1:3, ]), 2)), 
                     correct = TRUE),
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ])/sum(imc[1:2, ])), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ]) + sum(imc[ ,3]) - imc[2,4]) / sum(imc[1:3, ]), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[1:3, ])/sum(imc[1:2, ])), 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE)
              )
```

## 2. Moyenne 

Calculez la moyenne, l'écart-type et le coefficient de variation du vecteur ci-dessous

```{r moyenne}
(x <- round(sample(20:30, size = 5) + rnorm(n = 5,mean = 0,sd = 1),2))
```

Vous avez à votre disposition une zone de code

```{r mean_cal, exercise = TRUE}

```

Répondez aux questions ci-dessous :

```{r qeq_moyenne}
quiz(question("Calculez la moyenne du vecteur ",
              answer(sprintf("$%s$", 
                             round(mean(x), 2)), correct = TRUE),
              answer(sprintf("$%s$", round(mean(x[-1]), 2))),
              answer(sprintf("$%s$", 
                             round(mean(x)-1, 2))),
              answer(sprintf("$%s$", 
                             round(x[3], 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE),
     question("Calculez l'écart-type du vecteur",
              answer(sprintf("$%s$", 
                             round(sd(x), 2)), correct = TRUE),
              answer(sprintf("$%s$", 
                             round(sd(x[-1]), 2))),
              answer(sprintf("$%s$", 
                             round(sd(x)-3,2))),
              answer(sprintf("$%s$", 
                             round(x[2], 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE),
     question("Calculez le coefficient de variation du vecteur en pourcent",
              answer(sprintf("$%s$", 
                             round(100*(sd(x)/mean(x)), 2)), correct = TRUE),
              answer(sprintf("$%s$", 
                             round(100*(sd(x[-1])/mean(x)), 2))),
              answer(sprintf("$%s$", 
                             round(100*(sd(x)-1)/mean(x)), 2)),
              answer(sprintf("$%s$", 
                             round(100*(x[2]/mean(x)), 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE)
     )
```

## 3. Analyse d'un histogramme

Réalisez un histogramme sur base de la variable `x` du jeu de donnée `df`.

**Des snippets sont mis à votre disposition en fin de question**

```{r, message= FALSE, warning= FALSE}
set.seed(1000)
df1 <- data_frame(x = rnorm(5000, 35, 5))
df <- rbind(df1, data_frame(x = rnorm(7000, 60, 5)))
```

```{r, echo = TRUE}
# nom du jeu de données : df
# nom des colonnes
names(df)
# résumé des données
summary(df)
```

```{r histo_prepa}
set.seed(1000)
df1 <- data_frame(x = rnorm(5000, 35, 5))
df <- rbind(df1, data_frame(x = rnorm(7000, 60, 5)))
```

```{r eqc_histo, exercise = TRUE, exercise.setup = "histo_prepa"}

```

Répondez à la question ci-dessous sur base du graphique ci-dessus:

```{r qeq_histo}
quiz(
  question("Définissez le mode de l'histogramme",
         answer("unimodal"),
         answer("bimodal", correct = TRUE),
         answer("multimodal"),
         random_answer_order = TRUE),
  question("Définissez la symétrie des sous-populations de l'histogramme",
         answer("symétrique", correct = TRUE), 
         answer("asymétrique"),
         random_answer_order = TRUE)
)
```

```{r, echo = TRUE, eval = FALSE}
## Charts ###############################################################################################
# ...charts
#..c

## Charts: Add ##########################################################################################
#..charts: add layers or annotations
#.ca

#.caplotly: convert last ggplot2 into interactive chart
plotly::ggplotly()

#.caylab: add or change Y label
${1:CHART} +
  ylab("${2:YOUR Y LABEL HERE}")

#.caxlab: add or change X label
${1:CHART} +
  xlab("${2:YOUR X LABEL HERE}")

#.catitle: add a plot title
${1:CHART} +
  ggtitle("${2:YOUR TITLE HERE}")

## Charts: Multivariate #################################################################################
# ..charts: multivariate
# .cm

#.cmcorr: correlation chart
corrplot::corrplot(cor(${1:DF}[, ${2:1:3}],
                       use = "pairwise.complete.obs"), method = "ellipse")

#.cmxy: multivariate X-Y scatterplot
GGally::ggscatmat(as.data.frame(${1:DF}), ${2:1:3})

## Charts: Bivariate ####################################################################################
snippet ..charts: bivariate
	.cb

#.cbhistfact: histogram by factor (facets)
chart(data = ${1:DF}, ~${2:XNUM} %fill=% ${3:XFACTOR} | ${3:XFACTOR}) +
  geom_histogram(data = select(${1:DF}, -${3:XFACTOR}), fill = "grey", bins = ${4:30}) +
  geom_histogram(bins = ${4:30}, show.legend = FALSE)

#.cberrbar2: error bars by two factors
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} %col=% ${4:XFACTOR2}) +
  geom_jitter(alpha = 0.4, position = position_dodge(0.4)) +
  stat_summary(geom = "point", fun.y = "mean", position = position_dodge(0.4)) +
  stat_summary(geom = "errorbar", width = 0.1, position = position_dodge(0.4),
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

#.cberrbar: error bars by factor
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
  geom_jitter(alpha = 0.4, width = 0.2) +
  stat_summary(geom = "point", fun.y = "mean") +
  stat_summary(geom = "errorbar", width = 0.1,
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

#.cbviolin: violinplot by factor
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
  geom_violin()

#.cbbox: boxplot by factor
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
  geom_boxplot()

#.cbxy: X-Y scatterplot
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XNUM}) +
  geom_point()

## Charts: Univariate ###################################################################################
# ..charts: univariate
#.cu

#.cuqqchisq: QQ plot - chi-square
car::qqPlot(${1:DF}[["${2:XNUM}"]], distribution = "chisq", df = ${3:DEGREES_OF_FREEDOM},
            envelope = 0.95, col = "Black", ylab = "${2:XNUM}")

#.cuqqf: QQ plot - F
car::qqPlot(${1:DF}[["${2:XNUM}"]], distribution = "f", df1 = ${3:NUMERATOR_DF}, df2 = ${4:DENOMINATOR_DF},
            envelope = 0.95, col = "Black", ylab = "${2:XNUM}")

#.cuqqt: QQ plot - Student t
car::qqPlot(${1:DF}[["${2:XNUM}"]], distribution = "t", df = ${3:DEGREES_OF_FREEDOM},
            envelope = 0.95, col = "Black", ylab = "${2:XNUM}")

#.cuqqnorm: QQ plot - normal
car::qqPlot(${1:DF}[["${2:XNUM}"]], distribution = "norm",
            envelope = 0.95, col = "Black", ylab = "${2:XNUM}")

#.cuhbar: horizontal bars
chart(data = ${1:DF}, ~factor(${2:VAR})) +
  geom_bar() + coord_flip()

#.cuvbar: vertical bars
chart(data = ${1:DF}, ~factor(${2:VAR})) +
  geom_bar()

#.cuhist: histogram
chart(data = ${1:DF}, ~${2:VARNUM}) +
  geom_histogram(binwidth = ${3:30})
```

## 4. Choix d'un test statistique

```{r qeq_bartlet}
quiz(question("Sélectionnez les tests statistiques qui permettent de vérifier l'homogénéité des variances",
         answer("Test de Bartlett", correct = TRUE),
         answer("Test de Shapiro-wilk"),
         answer("Test de Friedman"),
         answer("Test de Pearson"),
         answer("Aucune des réponses proposées"),
         random_answer_order = TRUE),
     question("Y a t'il homoscédasticité avec une valeur de p de 0.0003 au seuil $\\alpha$ de 0.05",
              answer("Oui"),
              answer("Non", correct = TRUE),
         random_answer_order = TRUE))
```

## 5. Parité au sein d'une entreprise 

Une étude est menée au sein d'une entreprise qui s'intéresse à la parité homme-femme en son sein.

```{r}
(tab <- as.table(c(Homme = 2301, Femme = 2438)))
```

```{r}
chisq.test(tab, p = c(1/2, 1/2), rescale.p = FALSE)
```

Suite à l'analyse ci-dessus, répondez aux questions ci-dessous :

```{r qeq_chi2}
quiz(question("De quel test s'agit-il ?",
              answer(text = "chi^2 univarié", correct = TRUE),
              answer(text = "chi^2 d'indépendance"),
              answer("test de Student univarié"),
              answer("test de Wilcoxon univarié"),
              answer("Aucune des réponses proposées"),
              random_answer_order = TRUE),
     question("Y a t'il parité entre les homme et les femmes au seuil alpha de 0.05",
              answer(text ="oui"),
              answer(text = "non", correct = TRUE),
              random_answer_order = TRUE))
```

## 6. Calcul de quantiles et de probabilités

```{r}
# moyenne 
m <- sample(x = 120:180, size = 1)
# écart-type
s <- sample(x = 1:25, size = 1)
# valeur d'intérêt
q <- sample(x = 100:230, size = 1)
# valeur d'intérêt 2
y <- sample(x = 110:150, size = 1)
# valeur d'intérêt 3
y1 <- sample(x = 80:100, size = 1)
```

Dans un champs de maïs (Considérez le nombre de plant de mais comme très grand), dont la taille moyenne est de `r m`  cm et d'écart type de `r s` cm. 

**Des snippets  sont mis à votre disposition en fin de question**

```{r dnorm_cal, exercise = TRUE}

```

```{r}
# Q1
q1 <- pnorm(q, mean = m, sd = s, lower.tail = FALSE)
q2 <- pnorm(q + 10, mean = m, sd = m-s, lower.tail = TRUE)
q3 <- pnorm(m, mean = q, sd = s, lower.tail = FALSE)
q4 <- pnorm(m, mean = q - m, sd = s, lower.tail = FALSE)
# p1
p1 <- pnorm(y, mean = m, sd = s, lower.tail = TRUE) - pnorm(y1, mean = m, sd = s, lower.tail = TRUE)
p2 <- pnorm(y, mean = m, sd = s, lower.tail = TRUE) - pnorm(y1, mean = m-s, sd = s, lower.tail = FALSE)
p3 <- pnorm(y, mean = q, sd = q, lower.tail = TRUE) - pnorm(y1, mean = m-s, sd = s/2, lower.tail = TRUE)
p4 <- pnorm(y, mean = m, sd = s, lower.tail = TRUE) - pnorm(y1, mean = q, sd = s, lower.tail = TRUE)
```

```{r qeq_dnorm}
quiz(question(
  sprintf("Quelle est la probabilité d'obtenir une plante de plus de $%s$ cm ?", q), 
  answer(sprintf("$%s$", round(q1, 4)),correct = TRUE),
  answer(sprintf("$%s$", round(q2, 4))),
  answer(sprintf("$%s$", round(q3, 4))),
  answer(sprintf("$%s$", round(q4, 4))),
  answer("Aucune des réponses proposées"),
  random_answer_order = TRUE
  ),
question(
  sprintf("quelle est la probabilité d'obtenir une plante dont la taille est comprise entre $%s$ et $%s$ cm ?", y, y1), 
  answer(sprintf("$%s$", round(p1, 4)),correct = TRUE),
  answer(sprintf("$%s$", round(p2, 4))),
  answer(sprintf("$%s$", round(p3, 4))),
  answer(sprintf("$%s$", round(p4, 4))),
  answer("Aucune des réponses proposées"),
  random_answer_order = TRUE
  )
)
```

```{r,echo = TRUE, eval = FALSE}
### .iu : distribution uniforme 
punif(QUANTILES, min = 0, max = 1, lower.tail = TRUE)
qunif(PROBABILITIES, min = 0, max = 1, lower.tail = TRUE)

### .in distribution normale
pnorm(QUANTILES, mean = 0, sd = 1, lower.tail = TRUE)
qnorm(PROBABILITIES, mean = 0, sd = 1, lower.tail = TRUE)

### .il distribution log-normal
plnorm(QUANTILES, meanlog = 0, sdlog = 1, lower.tail = TRUE)
qlnorm(PROBABILITIES, meanlog = 0, sdlog = 1, lower.tail = TRUE)

### .it distribution de student
.mu <- 0; .s <- 1; pt((QUANTILES - .mu)/.s, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)
.mu <- 0; .s <- 1; .mu + .s * qt(PROBABILITIES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)

### .ib distribution binomial
pbinom(QUANTILES, size = N_TRIALS, prob = SUCCESS_PROB, lower.tail = TRUE)
qbinom(PROBABILITIES, size = N_TRIALS, prob = SUCCESS_PROB, lower.tail = TRUE)

### .ip distribution de poisson
ppois(QUANTILES, lambda = MEAN_OCCURENCES, lower.tail = TRUE)
qpois(PROBABILITIES, lambda = MEAN_OCCURENCES, lower.tail = TRUE)

### .ic distribution chi2
pchisq(QUANTILES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)
qchisq(PROBABILITIES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)

### .if distibution de F
pf(QUANTILES, df1 = NUMERATOR_DF, df2 = DENOMINATOR_DF, lower.tail = TRUE)
```
## 7. Test de Student :

```{r}
set.seed(43)
weight <- data_frame(weight = c(rnorm(n = 15, mean = 100, sd = 5), 
                      rnorm(n = 15, mean = 102, sd = 5)), 
           area = rep(c("a", "b"), each = 15))
weight$area <- as.factor(weight$area)
```

```{r student1_prepa}
set.seed(43)
weight <- data_frame(weight = c(rnorm(n = 15, mean = 100, sd = 5), 
                      rnorm(n = 15, mean = 102, sd = 5)), 
           area = rep(c("a", "b"), each = 15))
weight$area <- as.factor(weight$area)
```

Vous avez à votre disposition le jeu de données `weight` dont voici quelques informations :

```{r, echo = TRUE}
# nom du jeu de données : weight
# nom des variables du jeu de données
names(weight)
# résumé des variables
summary(weight)
```

Réalisez un test de Student bilatéral avec un seuil $\alpha$ de 0.05 et de variance inégale.

**Des snippets  sont mis à votre disposition en fin de question**

```{r student1, exercise = TRUE, exercise.setup = "student1_prepa"}

```

```{r qeq_stu}
quiz(
  question("quels sont les résultats de ce test ?",
         answer("t = $-1.452$, df = $27.994$, p-value = 0.1575", correct = TRUE),
         answer("t = $-1.452$, df = $28$, p-value = 0.1575"),
         answer("t = $-1.452$, df = $28$, p-value = 0.0787"),
         answer("t = $-1.452$, df = $27.994$, p-value = 0.0787"),
         random_answer_order = TRUE),
  question("Y a t'il une différence significative au seuil $\\alpha$ de 0.05 de masse entre les deux zones étudiées pour la masse monitorée",
         answer("oui"),
         answer("non", correct = TRUE), 
         random_answer_order = TRUE))
```

```{r, echo = TRUE, eval = FALSE}
# .hm
# .hmttestindep: independent Student's t-test
t.test(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}, alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)

# .hmttestpaired: paired Student's t-test
t.test(${1:DF}\$XNUM, ${1:DF}\$YNUM, alternative = "two.sided", conf.level = 0.95, paired = TRUE)

# .hmttestuni: univariate Student's t-test
t.test(${1:DF}\$2:XNUM, alternative = "two.sided", mu = 0, conf.level = 0.95)
```

## 8.  Distribution

```{r qeq_t}
question("Quels sont les paramètres de la distribution T ?",
         answer("$\\mu$", correct = TRUE),
         answer("n-1", correct = TRUE),
         answer("degré de liberté", correct = TRUE),
         answer("degré de liberté intra-groupe"),
         answer("degré de lberté inter-groupe"),
         answer("$\\sigma$"),
         answer("écart-type", correct = TRUE),
         answer("nombre d'essai"),
         answer("probabilité de succès"),
         answer("lambda"),
         answer("moyenne", correct = TRUE),
         random_answer_order = TRUE)
```

## 9. Corrélation

Sur base de la matrice de corrélation ci-dessous :

```{r, echo=FALSE}
library(MASS)
data("crabs")
crabs_cor <- crabs[, c(4:8)]
pander::pander(cor(x = crabs_cor, y = NULL, use = "complete.obs", method = "spearman"))
```

```{r qeq_corr}
question("Quelles sont les variables les plus corrélées ? (vous devez sélectionner 2 réponses)",
              answer("FL"),
              answer("RW"),
              answer("CL", correct = TRUE),
              answer("CW", correct = TRUE),
              answer("BD"),
              random_answer_order = TRUE)
```

## 10. Test de comparaisons multiples

```{r, echo = TRUE}
is <- data.io::read("iris", package = "datasets", lang = "fr")
summary(is)
```

```{r, echo = TRUE}
anova(anova. <- lm(data = is, petal_length ~ species))
```

Suite à l'analyse des résultats ci-dessus, réalisez un test de comparaison multiple de Tukey. 

**Des snippets  sont mis à votre disposition en fin de question**

```{r resi_prepa}
is <- data.io::read("iris", package = "datasets", lang = "fr")
anova(anova. <- lm(data = is, petal_length ~ species))
```

```{r tukey, exercise = TRUE, exercise.setup = "resi_prepa"}

```

```{r qeq_tukey}
quiz(
  question("Est-il nécessaire de réaliser une test de comparaisons multiples de Tukey ? ",
         answer("oui", correct = TRUE),
         answer("non")),
  question("Quelles sont les combinaisons de variables significativements différentes au seuil alpha de 0.05", 
         answer("versicolor - setosa", correct = TRUE),
         answer("virginica - setosa", correct = TRUE),
         answer("virginica - versicolor", correct = TRUE),
         answer("aucune des propositions")))
```

```{r, echo = TRUE, eval = FALSE}
# ..hypothesis tests: means
#.hm

# .hmanovamult: anova - multiple comparisons [multcomp]
summary(anovaComp. <- confint(multcomp::glht(anova.,
  linfct = multcomp::mcp(${1:XFACTOR} = "Tukey")))) # Add a second factor if you want
.oma <- par(oma = c(0, 5.1, 0, 0)); plot(anovaComp.); par(.oma); rm(.oma)

# .hmanovaresid: anova - residuals
residuals(anova.)

# .hmanovaqqplot: anova - residuals QQ-plot
# plot(anova., which = 2)
anova. %>.%
  chart(broom::augment(.), aes(sample = .std.resid)) +
  geom_qq() +
  #geom_qq_line(colour = "darkgray") +
  labs(x = "Theoretical quantiles", y = "Standardized residuals") +
  ggtitle("Normal Q-Q")

# .hmanova2nested: two-way ANOVA (nested model)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR} + ${4:BLOCK} %in% ${3:XFACTOR}))

# .hmanova2noint: two-way ANOVA (without interactions)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} + ${4:XFACTOR2}))

# .hmanova2: two-way ANOVA (complete model)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} * ${4:XFACTOR2}))

# .hmanova2desc: two-way ANOVA (description)
${1:DF} %>.%
  group_by(., ${2:XFACTOR1}, ${3:XFACTOR2}) %>.%
  summarise(., mean = mean(${4:YNUM}), sd = sd(${4:YNUM}), count = sum(!is.na(${4:YNUM})))

# .hmanova1: one-way ANOVA
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}))

# .hmanova1desc: one-way ANOVA (description)
${1:DF} %>.%
  group_by(., ${2:XFACTOR}) %>.%
  summarise(., mean = mean(${3:YNUM}), sd = sd(${3:YNUM}), count = sum(!is.na(${3:YNUM})))

# .hmttestindep: independent Student's t-test
	t.test(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR},
		alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)

# .hmttestpaired: paired Student's t-test
t.test(${1:DF}\$XNUM, ${1:DF}\$YNUM,
       alternative = "two.sided", conf.level = 0.95, paired = TRUE)

# .hmttestuni: univariate Student's t-test
t.test(${1:DF}\$2:XNUM,
       alternative = "two.sided", mu = 0, conf.level = 0.95)
```

## 11. Analyse d'un test statistique 

```{r anova}
iris <- data.io::read("iris", package = "datasets")
sample(1:150, size = 100, replace = FALSE) -> t
anova(anova. <- lm(data = iris[ t, ], petal_length ~ species))
```

Répondez aux questions ci-dessous sur base du tableau proposé ci-dessus :

```{r quiz_anova}
quiz(question("De quelle analyse s'agit-il ?",
              answer(text = "Anova", correct = TRUE),
              answer(text = "Test de student"),
              answer(text = "Chi^2"),
              answer(text = "Test post-hoc"),
              answer("Aucune des réponses proposées"),
              random_answer_order = TRUE),
     question("Combien d'observation compte cette analyse ?",
              answer(text = "Aucune des réponses proposées", 
                     correct = TRUE),
              answer(text = "2"),
              answer(text = "97"),
              answer(text = "99"),
              answer(text = "3"),
              random_answer_order = TRUE))
```

## 12 . Choix d'un test statistique

```{r pearson}
question("Sélectionnez les tests statistiques qui permettent de vérifier la corrélation entre 2 variables",
         answer("test de Bartlett"),
         answer("test de Shapiro-wilk"),
         answer("test de Friedman"),
         answer("test de Pearson", correct = TRUE),
         answer("aucune des réponses proposées"),
         random_answer_order = TRUE)
```

## 13. Remaniement d'un tableau de données

```{r}
set.seed(43)
rep(c("A", "B", "C", "D", "E"), each = 20) -> t
tt <- c(rnorm(n = 20, mean = 10, sd = 1),
        rnorm(n = 20, mean = 12, sd = 1),
        rnorm(n = 20, mean = 11, sd = 1),
        rnorm(n = 20, mean = 12, sd = 1),
        rnorm(n = 20, mean = 14, sd = 1))
density <- data_frame(area = as.factor(t) , densi = tt)

density %>.%
  dplyr::filter(., area %in% c("A", "C", "D") & densi > 12.5) %>.%
  nrow(.)-> t111
```

```{r, echo = TRUE}
#nom du jeu de données : density
names(density)
summary(density)
```

Vous devez retirer les zones (`area`) **B** et **E** et ne garder que les valeurs de densité strictement supériere à 12.5. 

**Des snippets sont mis à votre disposition en fin de question**

```{r rema_cal_prep}
set.seed(43)
rep(c("A", "B", "C", "D", "E"), each = 20) -> t
tt <- c(rnorm(n = 20, mean = 10, sd = 1),
        rnorm(n = 20, mean = 12, sd = 1),
        rnorm(n = 20, mean = 11, sd = 1),
        rnorm(n = 20, mean = 12, sd = 1),
        rnorm(n = 20, mean = 14, sd = 1))
density <- data_frame(area = as.factor(t) , densi = tt)
```

```{r rema_cal, exercise = TRUE, exercise.setup = "rema_cal_prep"}

```

```{r qeq_rema}
question("Combien y a t'il de ligne dans ce tableau réduit ?", 
         answer(sprintf("$%s$", t111), correct = TRUE),
         answer(sprintf("$%s$", t111 + 22)),
         answer(sprintf("$%s$", t111 + 3)),
         answer(sprintf("$%s$", t111+1)),
         answer(sprintf("$%s$", t111 + 52)),
         random_answer_order = TRUE)
```

```{r, echo = TRUE, eval=FALSE}
#.dosel select cases
DF %>.%
  filter(., CONDITIONS) -> DF2
DF %>.%
  select(., VAR1, VAR2) -> DF2
```

## 14. Distribution de Fischer 

```{r qeq_f}
question("A quels tests statistiques pouvez vous associer la distribution de Fischer",
         answer("Anova", correct = TRUE),
         answer("Test t de Student"),
         answer("Test de Kruskal-Wallis"),
         answer("Test post-hoc de Tukey"),
         answer("Test de Wilcoxon"),
         answer("Test de chi^2"),
         random_answer_order = TRUE)
```

## 15. Conditions d'application

```{r qeq_kruskal}
question("Sélectionnez les conditions d'application d'un test de Kruskal-Wallis ?",
  answer("échantillon représentatif (par exemple, aléatoire)", correct = TRUE),
  answer("observations indépendantes", correct = TRUE),
  answer("variable dite réponse quantitative", correct = TRUE),
  answer("variable dite explicative qualitative à trois niveaux ou plus", correct = TRUE),
  answer("les distributions au sein des différentes sous-population sont, si possible, similaires mais de forme quelconque", 
         correct = TRUE),
  answer("distribution normale des résidus"),
  answer("homoscédasticité"),
  answer("distribution de la population normale ou approximativement normale"),
  answer("une variable facteur dite explicative à deux niveaux"),
  random_answer_order = TRUE
)
```

## 16. Reproduction d'un graphique

Reproduisez le graphique suivant

```{r}
set.seed(43)
df <- data_frame(x = 1:300 + rnorm(n = 300, mean = 10, sd = 5), 
                   y = x + rnorm(n = 300, mean = 10, sd = 5),
                   zone = as.factor(rep(c("A", "B"), times = 150)),
                   area = as.factor(rep(1:3, each = 100))
                   )
```

```{r}
chart(data = df, ~ y %fill=% area | area) +
  # histogramme d'arrière plan en gris ne tenant pas compte de la variable species
  geom_histogram(data = select(df, -area), fill = "grey") + 
  geom_histogram(show.legend = FALSE) +
  ylab("Effectifs")
```

avec le jeu de donnée df

```{r, echo = TRUE}
# nom du jeu de données df
# names
names(df)
summary(df)
```

**Des snippets sont mis à votre disposition en fin de question**

```{r reprod_prepa}
set.seed(43)
df <- data_frame(x = 1:300 + rnorm(n = 300, mean = 10, sd = 5), 
                   y = x + rnorm(n = 300, mean = 10, sd = 5),
                   zone = as.factor(rep(c("A", "B"), times = 150)),
                   area = as.factor(rep(1:3, each = 100))
                   )
```

```{r qec_reprod, exercise = TRUE, exercise.setup = "reprod_prepa"}

```

```{r qec_reprod-check}
#TODO
```

Vous avez à votre disposition les snippets suivants

```{r, echo = TRUE, eval = FALSE}
## Charts ###############################################################################################
# ...charts
# ..c


## Charts: Add ##########################################################################################
# ..charts: add layers or annotations
# .ca

# .caplotly: convert last ggplot2 into interactive chart
	plotly::ggplotly()

# .caylab: add or change Y label
	${1:CHART} +
		ylab("${2:YOUR Y LABEL HERE}")

# .caxlab: add or change X label
	${1:CHART} +
		xlab("${2:YOUR X LABEL HERE}")

# .catitle: add a plot title
	${1:CHART} +
		ggtitle("${2:YOUR TITLE HERE}")


## Charts: Multivariate #################################################################################
# ..charts: multivariate
# .cm

# .cmcorr: correlation chart
corrplot::corrplot(cor(${1:DF}[, ${2:1:3}], 
                       use = "pairwise.complete.obs"), method = "ellipse")

# .cmxy: multivariate X-Y scatterplot
	GGally::ggscatmat(as.data.frame(${1:DF}), ${2:1:3})


## Charts: Bivariate ####################################################################################
# ..charts: bivariate
# .cb

#.cbhistfact: histogram by factor (facets)
chart(data = ${1:DF}, ~${2:XNUM} %fill=% ${3:XFACTOR} | ${3:XFACTOR}) +
	  geom_histogram(data = select(${1:DF}, -${3:XFACTOR}), fill = "grey", bins = ${4:30}) +
	  geom_histogram(bins = ${4:30}, show.legend = FALSE)

# .cberrbar2: error bars by two factors
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} %col=% ${4:XFACTOR2}) +
  geom_jitter(alpha = 0.4, position = position_dodge(0.4)) +
  stat_summary(geom = "point", fun.y = "mean", position = position_dodge(0.4)) +
  stat_summary(geom = "errorbar", width = 0.1, position = position_dodge(0.4),
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

#.cberrbar: error bars by factor
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
  geom_jitter(alpha = 0.4, width = 0.2) +
  stat_summary(geom = "point", fun.y = "mean") +
  stat_summary(geom = "errorbar", width = 0.1,
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

# .cbviolin: violinplot by factor
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
		geom_violin()

# .cbbox: boxplot by factor
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
		geom_boxplot()

# .cbxy: X-Y scatterplot
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XNUM}) +
		geom_point()
```

## Conclusion

Vous venez de terminer votre examen.

Laissez nous vos impressions sur cet outil pédagogique ou expérimentez encore dans la zone ci-dessous. Rappelez-vous que pour placer un commentaire dans une zone de code R, vous devez utilisez un dièse (`#`) devant vos phrases.

```{r comm, exercise=TRUE, exercise.lines = 8}
# Ajout de commentaires 
# ...
```

```{r comm-check}
# Not yet...
```