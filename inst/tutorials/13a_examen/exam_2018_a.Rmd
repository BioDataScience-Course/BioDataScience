---
title: "Examen de janvier 2018 : Version A"
subtitle: "Traitement des données I"
author: "Guyliann Engels & Philippe Grosjean"
output:
  learnr::tutorial
tutorial:
  id: "sdd1.13a"
  version: 0.1.0
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(knitr)
SciViews::R()

options(tutorial.event_recorder = BioDataScience::record_sdd)
tutorial_options(exercise.checker = BioDataScience::checker_sdd)
tutorial_options(exercise.timelimit = 60)
tutorial_options(exercise.cap = "Code R")
knitr::opts_chunk$set(echo = FALSE, comment = NA)

library(BioDataScience)
#dataset

```

```{r, echo=FALSE}
fixedRow(
  column(9, div(
    img(src = 'images/BioDataScience-128.png', align = "left"),
    h1("Science des données biologiques"),
    "Réalisé par le service d'Écologie numérique des Milieux aquatiques, Université de Mons (Belgique)"
  )),
  column(3, div(
    textInput("user", "Utilisateur :", ""),
    textInput("email", "Email :", "")
  ))
)
textOutput("user") # This is newer shown, but required to trigger an event!
textOutput("email") # Idem!
```

```{r, context="server"}
output$user <- renderText({BioDataScience::user_name(input$user);""})
output$email <- renderText({BioDataScience::user_email(input$email);""})
updateTextInput(session, "user", value = BioDataScience::user_name())
updateTextInput(session, "email", value = BioDataScience::user_email())
```

## Préambule

Durant l'ensemble du cours, vous avez été confronté à des learnr afin de vérifier l'acquisition de différents concepts lié à la science des données biologiques. Votre examen vous est proposé sous le même format. 

Vous avez 20 questions. 

![](images/attention.jpg)

**Ne vous trompez pas dans votre adresse mail et votre identifiant Github**

**N'oubliez pas de soumettre votre réponse après chaque exercice**

> Conformément au RGPD ([Règlement Général sur la Protection des Données](https://ec.europa.eu/info/law/law-topic/data-protection/reform/rules-business-and-organisations/principles-gdpr_fr)), nous sommes tenus de vous informer de ce que vos résultats seront collecté afin de suivre votre progression. **Les données seront enregistrées au nom de l'utilisateur apparaissant en haut de cette page. Corrigez si nécessaire !** En utilisant ce tutoriel, vous marquez expressément votre accord pour que ces données puissent être collectées par vos enseignants et utilisées pour vous aider et vous évaluer. Après avoir été anonymisées, ces données pourront également servir à des études globales dans un cadre scientifique et/ou éducatif uniquement.



## Calcul de probabilités

Sur base d'un questionnaire lié à l'indice de masse corporelle et l'activité physique, les chercheurs ont classé les individus en différents niveaux d'activité physique et d'IMC. Ils obtiennent le tableau suivant : 

```{r}
imc <- data.frame("Sous-poids" = sample(20:70, size = 3), 
                     "Normal" = sample(30:80, size = 3), 
                     "Surpoids" = sample(10:60, size = 3),
                     "Obésité" = sample(0:50, size = 3),
                     row.names = c("Activité physique occasionnelle", "Activité physique régulière", "Activité physique de haut niveau"))
knitr::kable(imc, caption = "Tableau")
```

Afin de vous aider dans vos réflexions, voici la somme des lignes et des colonnes

```{r, echo=TRUE}
# Somme des lignes
(rowSums(imc) -> x)
# Somme des colonnes
(colSums(imc) -> y)
# Somme totale d'observations
sum(x)
sum(y)
```

Vous avez à votre disposition une zone de code que vous pouvez évidement employer comme une calculatrice.

```{r proba_ref, exercise = TRUE}

```

Répondez aux questions ci-dessous sur base du tableau proposé ci-dessus :

```{r proba_quiz}
quiz(question("Quelle est la probabilité d'avoir une activité physique de haut niveaux ?",
              answer(sprintf("$%s$", 
                             round((sum(imc[3, ])/sum(imc[1:3, ])), 2)), correct = TRUE),
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ])/sum(imc[1:2, ])), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[3, ])/sum(imc[1:2, ])), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[2:3, ])/sum(imc[1:2, ])), 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE),
     question("Quelle est la probabilité d'avoir une activité physique régulière ou d'être obèse ?",
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ]) + sum(imc[ ,4]) - imc[2,4]) / sum(imc[1:3, ]), 2)), 
                     correct = TRUE),
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ])/sum(imc[1:2, ])), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[2, ]) + sum(imc[ ,3]) - imc[2,4]) / sum(imc[1:3, ]), 2))),
              answer(sprintf("$%s$", 
                             round((sum(imc[1:3, ])/sum(imc[1:2, ])), 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE)
              )
```

## Moyenne 

Calculez la moyenne, l'écart-type et le coefficient de variation du vecteur ci-dessous

```{r moyenne, echo = TRUE}
(x <- sample(20:30, size = 5))
```

Vous avez à votre disposition une zone de code que vous pouvez évidement employer comme une calculatrice. (Soumettez votre réflexion)

```{r mean_ref, exercise = TRUE}

```

```{r mean_quiz}
quiz(question("Calculez la moyenne du vecteur x",
              answer(sprintf("$%s$", 
                             round(mean(x), 2)), correct = TRUE),
              answer(sprintf("$%s$", round(mean(x[-1]), 2))),
              answer(sprintf("$%s$", 
                             round(mean(x)-1, 2))),
              answer(sprintf("$%s$", 
                             round(x[3], 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE),
     question("Calculez l'écart-type du vecteur x",
              answer(sprintf("$%s$", 
                             round(sd(x), 2)), correct = TRUE),
              answer(sprintf("$%s$", 
                             round(sd(x[-1]), 2))),
              answer(sprintf("$%s$", 
                             round(sd(x)-3,2))),
              answer(sprintf("$%s$", 
                             round(x[2], 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE),
     question("Calculez le coefficient de variation du vecteur x en pourcent",
              answer(sprintf("$%s$", 
                             round(100*(sd(x)/mean(x)), 2)), correct = TRUE),
              answer(sprintf("$%s$", 
                             round(100*(sd(x[-1])/mean(x)), 2))),
              answer(sprintf("$%s$", 
                             round(100*(sd(x)-1)/mean(x)), 2)),
              answer(sprintf("$%s$", 
                             round(100*(x[2]/mean(x)), 2))),
              answer("Aucune réponse n'est correcte"),
              random_answer_order = TRUE)
     )

```

## Réalisation de graphique

vous avez à votre dispositon les snippets suivants:

```{r, echo = TRUE, eval = FALSE}
## Charts ###############################################################################################
# ...charts
# ..c


## Charts: Add ##########################################################################################
# ..charts: add layers or annotations
# .ca

# .caplotly: convert last ggplot2 into interactive chart
	plotly::ggplotly()

# .caylab: add or change Y label
	${1:CHART} +
		ylab("${2:YOUR Y LABEL HERE}")

# .caxlab: add or change X label
	${1:CHART} +
		xlab("${2:YOUR X LABEL HERE}")

# .catitle: add a plot title
	${1:CHART} +
		ggtitle("${2:YOUR TITLE HERE}")


## Charts: Multivariate #################################################################################
# ..charts: multivariate
# .cm

# .cmcorr: correlation chart
corrplot::corrplot(cor(${1:DF}[, ${2:1:3}], 
                       use = "pairwise.complete.obs"), method = "ellipse")

# .cmxy: multivariate X-Y scatterplot
	GGally::ggscatmat(as.data.frame(${1:DF}), ${2:1:3})


## Charts: Bivariate ####################################################################################
# ..charts: bivariate
# .cb

#.cbhistfact: histogram by factor (facets)
chart(data = ${1:DF}, ~${2:XNUM} %fill=% ${3:XFACTOR} | ${3:XFACTOR}) +
	  geom_histogram(data = select(${1:DF}, -${3:XFACTOR}), fill = "grey", bins = ${4:30}) +
	  geom_histogram(bins = ${4:30}, show.legend = FALSE)

# .cberrbar2: error bars by two factors
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} %col=% ${4:XFACTOR2}) +
  geom_jitter(alpha = 0.4, position = position_dodge(0.4)) +
  stat_summary(geom = "point", fun.y = "mean", position = position_dodge(0.4)) +
  stat_summary(geom = "errorbar", width = 0.1, position = position_dodge(0.4),
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

#.cberrbar: error bars by factor
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
  geom_jitter(alpha = 0.4, width = 0.2) +
  stat_summary(geom = "point", fun.y = "mean") +
  stat_summary(geom = "errorbar", width = 0.1,
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

# .cbviolin: violinplot by factor
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
		geom_violin()

# .cbbox: boxplot by factor
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
		geom_boxplot()

# .cbxy: X-Y scatterplot
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XNUM}) +
		geom_point()
```

```{r}
biom <- data_frame(height = 1:100  + rnorm(n = 100, mean = 0, sd = 2), 
                   weight = (height*0.5) + rnorm(n = 100, mean = 0, sd = 2), 
                   zone = rep(c("A", "B"),each = 50 ))

```

```{r, echo = TRUE}
names(biom)
summary(biom)
```

Réalisez un nuage de point sur le jeu de données `biometry`, de la hauteur exprimé en cm (`height`) en fonction de la masse exprimée en gramme (`weight`). Utilisez la couleur pour mettre en avant les deux zones étudiées. Soyez complet

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

```{r chart_prepa}
biom <- data_frame(height = 1:100  + rnorm(n = 100, mean = 0, sd = 2), 
                   weight = (height*0.5) + rnorm(n = 100, mean = 0, sd = 2), 
                   zone = rep(c("A", "B"),each = 50 ))

```

```{r chart, exercise = TRUE, exercise.setup = "chart_prepa"}

```

```{r chart-check}
# TODO
chart(data = biom, height ~ weight %col=% zone) +
  geom_point() +
  labs(y = "Hauteur [cm]", x = "Masse [g]")
```


## Analyse d'un graphique 

```{r, message= FALSE, warning= FALSE}
set.seed(1000)
df1 <- data_frame(x = rnorm(5000, 35, 5))
df2 <- rbind(df1, data_frame(x = rnorm(7000, 60, 5)))
chart(data = df2, ~ x) +
  geom_histogram() +
  labs(x = "", y = "")
```

Répondez à la question ci-dessous sur base du graphique ci-dessus:

```{r histo}
question("Définissez le mode et la symétrie de l'histogramme ci-dessus (vous devez sélectionner 2 réponses)",
         answer("unimodal"),
         answer("bimodal", correct = TRUE),
         answer("multimodal"),
         answer("symétrique", correct = TRUE), 
         answer("asymétrique"))
```

## Choix d'un test statistique

Répondez aux questions ci-dessous

```{r bartlet}
quiz(question("Sélectionnez les tests statistiques qui permettent de vérifier l'homogénéité des variances",
         answer("Test de Bartlett", correct = TRUE),
         answer("Test de Shapiro-wilk"),
         answer("Test de Friedman"),
         answer("Test de Pearson"),
         answer("Aucune des réponses proposées"),
         random_answer_order = TRUE),
     question("Y a t'il homoscédasticité avec une p.value de 0.0003345 au seuil $\\alpha$ de 0.05",
              answer("Oui"),
              answer("Non", correct = TRUE),
         random_answer_order = TRUE))
```

## Analyse d'un test statistique  

Une étude est menée au sein d'une entreprise qui s'intéresse à la parité homme-femme en son sein.

```{r}
(tab <- as.table(c(Homme = 2301, Femme = 2438)))
```

```{r}
chisq.test(tab, p = c(1/2, 1/2), rescale.p = FALSE)
```

Suite à l'analyse ci-dessus, répondez aux questions ci-dessous

```{r chi2}
quiz(question("De quel test s'agit-il ?",
              answer(text = "chi^2 univarié", correct = TRUE),
              answer(text = "chi^2 d'indépendance"),
              answer("test de student univarié"),
              answer("test de wilcoxon univarié"),
              answer("Aucune des réponses proposées"),
              random_answer_order = TRUE),
     question("Y a t'il parité entre les homme et les femmes au seuil alpha de 0.05",
              answer(text ="oui"),
              answer(text = "non", correct = TRUE),
              random_answer_order = TRUE))
```

## Distribution

Les snippets vous donnent les instructions suivantes afin de calculer les quantiles et les probabilités:

```{r,echo = TRUE, eval = FALSE}
### .iu : distribution uniforme 
punif(QUANTILES, min = 0, max = 1, lower.tail = TRUE)
qunif(PROBABILITIES, min = 0, max = 1, lower.tail = TRUE)

### .in distribution normale
pnorm(QUANTILES, mean = 0, sd = 1, lower.tail = TRUE)
qnorm(PROBABILITIES, mean = 0, sd = 1, lower.tail = TRUE)

### .il distribution log-normal
plnorm(QUANTILES, meanlog = 0, sdlog = 1, lower.tail = TRUE)
qlnorm(PROBABILITIES, meanlog = 0, sdlog = 1, lower.tail = TRUE)

### .it distribution de student
.mu <- 0; .s <- 1; pt((QUANTILES - .mu)/.s, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)
.mu <- 0; .s <- 1; .mu + .s * qt(PROBABILITIES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)

### .ib distribution binomial
pbinom(QUANTILES, size = N_TRIALS, prob = SUCCESS_PROB, lower.tail = TRUE)
qbinom(PROBABILITIES, size = N_TRIALS, prob = SUCCESS_PROB, lower.tail = TRUE)

### .ip distribution de poisson
ppois(QUANTILES, lambda = MEAN_OCCURENCES, lower.tail = TRUE)
qpois(PROBABILITIES, lambda = MEAN_OCCURENCES, lower.tail = TRUE)

### .ic distribution chi2
pchisq(QUANTILES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)
qchisq(PROBABILITIES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)

### .if distibution de F
pf(QUANTILES, df1 = NUMERATOR_DF, df2 = DENOMINATOR_DF, lower.tail = TRUE)
```

Dans un champs de maïs (Considérez le nombre de plant de mais comme très grand), dont la taille moyenne est de 140 cm et d'écart type de 25 cm. Quelle est la probabilité d'obtenir une plante de plus de 195 cm ? Utilisez la fonction adéquate.

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

```{r distri_normal, exercise = TRUE}

```

```{r distri_normal-check}
# TODO
pnorm(195, mean = 140, sd = 25, lower.tail = FALSE)
```

Dans un ce même champs de mais, quelle est la probabilité d'obtenir une plante dont la taille est comprise entre 120 et 130 cm ?

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

```{r distri_normal2, exercise = TRUE}

```

```{r distri_normal2-check}
# TODO
pnorm(130, mean = 140, sd = 25, lower.tail = TRUE) - pnorm(120, mean = 140, sd = 25, lower.tail = TRUE)
```

## Distribution 

Les snippets vous donnent les instructions suivantes afin de calculer les quantiles et les probabilités:

```{r,echo = TRUE, eval = FALSE}
### .iu : distribution uniforme 
punif(QUANTILES, min = 0, max = 1, lower.tail = TRUE)
qunif(PROBABILITIES, min = 0, max = 1, lower.tail = TRUE)

### .in distribution normale
pnorm(QUANTILES, mean = 0, sd = 1, lower.tail = TRUE)
qnorm(PROBABILITIES, mean = 0, sd = 1, lower.tail = TRUE)

### .il distribution log-normal
plnorm(QUANTILES, meanlog = 0, sdlog = 1, lower.tail = TRUE)
qlnorm(PROBABILITIES, meanlog = 0, sdlog = 1, lower.tail = TRUE)

### .it distribution de student
.mu <- 0; .s <- 1; pt((QUANTILES - .mu)/.s, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)
.mu <- 0; .s <- 1; .mu + .s * qt(PROBABILITIES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)

### .ib distribution binomial
pbinom(QUANTILES, size = N_TRIALS, prob = SUCCESS_PROB, lower.tail = TRUE)
qbinom(PROBABILITIES, size = N_TRIALS, prob = SUCCESS_PROB, lower.tail = TRUE)

### .ip distribution de poisson
ppois(QUANTILES, lambda = MEAN_OCCURENCES, lower.tail = TRUE)
qpois(PROBABILITIES, lambda = MEAN_OCCURENCES, lower.tail = TRUE)

### .ic distribution chi2
pchisq(QUANTILES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)
qchisq(PROBABILITIES, df = DEGREES_OF_FREEDOM, lower.tail = TRUE)

### .if distibution de F
pf(QUANTILES, df1 = NUMERATOR_DF, df2 = DENOMINATOR_DF, lower.tail = TRUE)
```

Considérant qu'un test de Student bilatéral est utilisé avec un échantillon de 100 individus divisé en deux groupes équivalent. La variance entre groupes est similaire.

Nous avons également à notre disposition une valeur de quantile de -10.51, y a t'il un rejet de H0 au seuil alpha de 0.05 ?

```{r distri3, exercise = TRUE}

```

```{r distri3-check}
#TODO
.mu <- 0; .s <- 1; pt((-10.51 - .mu)/.s, df = 99, lower.tail = TRUE)
.mu <- 0; .s <- 1; .mu + .s * qt(0.025, df = 99, lower.tail = TRUE)
```

```{r distri3_quiz}
question("Y a t'il rejet de H0 ?",
         answer("oui", correct = TRUE),
         answer("non"),
         random_answer_order = TRUE)
```


## Test de Student :

```{r}
weight <- data_frame(weight = c(rnorm(n = 250, mean = 100, sd = 10), 
                      rnorm(n = 250, mean = 110, sd = 10)), 
           area = rep(c("a", "b"), each = 250))
weight$area <- as.factor(weight$area)
```

```{r student1_prepa}
weight <- data_frame(weight = c(rnorm(n = 250, mean = 100, sd = 5), 
                      rnorm(n = 250, mean = 102, sd = 5)), 
           area = rep(c("a", "b"), each = 250))
weight$area <- as.factor(weight$area)
```

Vous avez à votre disposition le jeu de données `weight` dont voici quelques informations :

```{r, echo = TRUE}
# nom du jeu de données : weight
# nom des variables du jeu de données
names(weight)
# résumé des variables
summary(weight)
```

Vous avez également à votre disposition les variantes du test de Student présent dans les snippets.

```{r, echo = TRUE, eval = FALSE}
# .hm
# .hmttestindep: independent Student's t-test
t.test(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}, alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)

# .hmttestpaired: paired Student's t-test
t.test(${1:DF}\$XNUM, ${1:DF}\$YNUM, alternative = "two.sided", conf.level = 0.95, paired = TRUE)

# .hmttestuni: univariate Student's t-test
t.test(${1:DF}\$2:XNUM, alternative = "two.sided", mu = 0, conf.level = 0.95)
```

Réalisez un test de Student bilatéral avec un seuil $\alpha$ de 0.05% et de variance inégale.

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

```{r student1, exercise = TRUE, exercise.setup = "student1_prepa"}

```

```{r student1-check}
# TODO
t.test(data = weight, weight ~ speceis, alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)
```

```{r stu_quiz}
question("Y a t'il une différence significative au seuil alpha de 0.05 de masse entre les deux zones étudiée pour la masse monitorée",
         answer("oui", correct = TRUE),
         answer("non"), 
         random_answer_order = TRUE)
```


## Anova

Quels sont les conditions d'application d'une anova à un facteur ?


**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

**Utilisez la dièse avant de répondre dans la zone de code**

```{r anova_cond, exercise = TRUE}
#
#
#
```

```{r anova_cond-check}
#TODO
```

## Distribution

Commentez l'expression suivantes

$Y \sim t(42, 5, 25)$

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

**Utilisez la dièse avant de répondre dans la zone de code**

```{r distri_stu, exercise = TRUE}
#
#
#
```

```{r distri_stu-check}
#TODO
```

## Corrélation

Sur base de la matrice de corrélation ci-dessous :

```{r, echo=FALSE}
library(MASS)
data("crabs")
crabs_cor <- crabs[, c(4:8)]
pander::pander(cor(x = crabs_cor, y = NULL, use = "complete.obs", method = "spearman"))
```

```{r quiz_corr}
question("Quelles sont les variables les plus corrélées ? (vous devez sélectionner 2 réponses)",
              answer("FL"),
              answer("RW"),
              answer("CL", correct = TRUE),
              answer("CW", correct = TRUE),
              answer("BD"),
              random_answer_order = TRUE)
```


## Type de tableau

Des chercheurs ont étudié l'affiliation politique: socialiste (PS), front national (FN) ou républicain (UMP), de citoyens français d'après leur genre: Homme ou Femme. 

Voici les résultats de cette étude :

```{r, include= TRUE, echo= FALSE}
M <- as.table(rbind(c(762, 327, 468), c(484, 239, 477)))
dimnames(M) <- list(gender = c("F", "H"),
                    party = c("PS","FN", "UMP"))
kable(M, caption = "Affiliation politique en fonction du genre de citoyens français. \\label{politique}")
```

- Comment s’appelle ce type de tableau? 

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

**Utilisez la dièse avant de répondre dans la zone de code**

```{r tab, exercise = TRUE}
#
#
#
```

```{r tab-check}
# Tableau de contingence à double entrée
```

- Que représentent les valeurs des cellules du tableau ? 

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

**Utilisez la dièse avant de répondre dans la zone de code**

```{r tab1, exercise = TRUE}
#
#
#
```

```{r tab1-check}
# Le tableau de contingence comptabilise les occurrences - les fréquences - d’événements disjoints telles qu’observées expérimentalement.
```

## Distribution 

Définissez les conditions d'application d'une distribution binomiale ? Quelles sont les paramètres de cette distribution ? 

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

**Utilisez la dièse avant de répondre dans la zone de code**

```{r binom, exercise = TRUE}
#
#
#
```

```{r binom-check}
# TODO  
```

## Conditions d'application 

Vous avez à votre disposition les snippets suivants provenant de la section `.hm`

```{r, echo = TRUE, eval = FALSE}
# ..hypothesis tests: means
#.hm

# .hmanovamult: anova - multiple comparisons [multcomp]
summary(anovaComp. <- confint(multcomp::glht(anova.,
  linfct = multcomp::mcp(${1:XFACTOR} = "Tukey")))) # Add a second factor if you want
.oma <- par(oma = c(0, 5.1, 0, 0)); plot(anovaComp.); par(.oma); rm(.oma)

# .hmanovaresid: anova - residuals
residuals(anova.)

# .hmanovaqqplot: anova - residuals QQ-plot
# plot(anova., which = 2)
anova. %>.%
  chart(broom::augment(.), aes(sample = .std.resid)) +
  geom_qq() +
  #geom_qq_line(colour = "darkgray") +
  labs(x = "Theoretical quantiles", y = "Standardized residuals") +
  ggtitle("Normal Q-Q")

# .hmanova2nested: two-way ANOVA (nested model)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR} + ${4:BLOCK} %in% ${3:XFACTOR}))

# .hmanova2noint: two-way ANOVA (without interactions)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} + ${4:XFACTOR2}))

# .hmanova2: two-way ANOVA (complete model)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} * ${4:XFACTOR2}))

# .hmanova2desc: two-way ANOVA (description)
${1:DF} %>.%
  group_by(., ${2:XFACTOR1}, ${3:XFACTOR2}) %>.%
  summarise(., mean = mean(${4:YNUM}), sd = sd(${4:YNUM}), count = sum(!is.na(${4:YNUM})))

# .hmanova1: one-way ANOVA
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}))

# .hmanova1desc: one-way ANOVA (description)
${1:DF} %>.%
  group_by(., ${2:XFACTOR}) %>.%
  summarise(., mean = mean(${3:YNUM}), sd = sd(${3:YNUM}), count = sum(!is.na(${3:YNUM})))

# .hmttestindep: independent Student's t-test
	t.test(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR},
		alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)

# .hmttestpaired: paired Student's t-test
t.test(${1:DF}\$XNUM, ${1:DF}\$YNUM,
       alternative = "two.sided", conf.level = 0.95, paired = TRUE)

# .hmttestuni: univariate Student's t-test
t.test(${1:DF}\$2:XNUM,
       alternative = "two.sided", mu = 0, conf.level = 0.95)
```

```{r, echo = TRUE}
is <- data.io::read("iris", package = "datasets", lang = "fr")
anova(anova. <- lm(data = is, petal_length ~ species))
```

Vérifier la normalité des résidus suite à cette analyse. 

```{r resi_prepa, results= "hide"}
is <- data.io::read("iris", package = "datasets", lang = "fr")
anova(anova. <- lm(data = is, petal_length ~ species))
```

```{r resi, exercise = TRUE, exercise.setup = "resi_prepa"}

```

```{r resi-check}
#TODO
```

```{r resi_quiz}
question("Sur base de ce que vous venez de faire considérez vous qeu l'anova est applicable",
         answer("oui", correct = TRUE),
         answer("non"))
```

Quelles sont les hypothèse nulles et alternative de l'anova réalisée ? 

```{r resi_ouverte}
#
#
#
```

```{r resi_ouverte-check}
# TODO
```

##  Test de comparaison multiple

Vous avez à votre disposition les snippets suivants provenant de la section `.hm`

```{r, echo = TRUE, eval = FALSE}
# ..hypothesis tests: means
#.hm

# .hmanovamult: anova - multiple comparisons [multcomp]
summary(anovaComp. <- confint(multcomp::glht(anova.,
  linfct = multcomp::mcp(${1:XFACTOR} = "Tukey")))) # Add a second factor if you want
.oma <- par(oma = c(0, 5.1, 0, 0)); plot(anovaComp.); par(.oma); rm(.oma)

# .hmanovaresid: anova - residuals
residuals(anova.)

# .hmanovaqqplot: anova - residuals QQ-plot
# plot(anova., which = 2)
anova. %>.%
  chart(broom::augment(.), aes(sample = .std.resid)) +
  geom_qq() +
  #geom_qq_line(colour = "darkgray") +
  labs(x = "Theoretical quantiles", y = "Standardized residuals") +
  ggtitle("Normal Q-Q")

# .hmanova2nested: two-way ANOVA (nested model)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR} + ${4:BLOCK} %in% ${3:XFACTOR}))

# .hmanova2noint: two-way ANOVA (without interactions)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} + ${4:XFACTOR2}))

# .hmanova2: two-way ANOVA (complete model)
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} * ${4:XFACTOR2}))

# .hmanova2desc: two-way ANOVA (description)
${1:DF} %>.%
  group_by(., ${2:XFACTOR1}, ${3:XFACTOR2}) %>.%
  summarise(., mean = mean(${4:YNUM}), sd = sd(${4:YNUM}), count = sum(!is.na(${4:YNUM})))

# .hmanova1: one-way ANOVA
anova(anova. <- lm(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}))

# .hmanova1desc: one-way ANOVA (description)
${1:DF} %>.%
  group_by(., ${2:XFACTOR}) %>.%
  summarise(., mean = mean(${3:YNUM}), sd = sd(${3:YNUM}), count = sum(!is.na(${3:YNUM})))

# .hmttestindep: independent Student's t-test
	t.test(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR},
		alternative = "two.sided", conf.level = 0.95, var.equal = TRUE)

# .hmttestpaired: paired Student's t-test
t.test(${1:DF}\$XNUM, ${1:DF}\$YNUM,
       alternative = "two.sided", conf.level = 0.95, paired = TRUE)

# .hmttestuni: univariate Student's t-test
t.test(${1:DF}\$2:XNUM,
       alternative = "two.sided", mu = 0, conf.level = 0.95)
```

```{r, echo = TRUE}
is <- data.io::read("iris", package = "datasets", lang = "fr")
summary(is)
```

```{r, echo = TRUE}
anova(anova. <- lm(data = is, petal_length ~ species))
```

Réalisez un test de comparaison multiple de Tukey

```{r tukey, exercise = TRUE, exercise.setup = "resi_prepa"}

```

```{r tukey-check}
# TODO
summary(anovaComp. <- confint(multcomp::glht(anova.,
  linfct = multcomp::mcp(species= "Tukey")))) # Add a second factor if you want
.oma <- par(oma = c(0, 5.1, 0, 0)); plot(anovaComp.); par(.oma); rm(.oma)
```

```{r tukey-quiz}
question("quelles sont les combinaisons de variable significativements différentes au seuil alpha de 0.05", 
         answer("versicolor - setosa", correct = TRUE),
         answer("virginica - setosa", correct = TRUE),
         answer("virginica - versicolor", correct = TRUE))
```

## Remaniement 

En partant du jeu de données urchin du package data.io, utiliser la fonction `filter()` afin de ne garder que les oursins avec une taille (`height`) inférieur à 3 et supérieur à 30

```{r filter, exercise = TRUE}
#importation
urchin <- data.io::read("urchin_bio", package = "data.io")
#filtre
#
```

```{r filter-check}
#urchin %>.%
# filter(., height > 30 | height < 3) 
```

## Analyse d'un test statistique 

```{r anova}
iris <- data.io::read("iris", package = "datasets")
sample(1:150, size = 100, replace = FALSE) -> t
anova(anova. <- lm(data = iris[ t, ], petal_length ~ species))
```

Répondez aux questions ci-dessous sur base du tableau proposé ci-dessus :

```{r quiz_anova}
quiz(question("De quelle analyse s'agit-il ?",
              answer(text = "Anova", correct = TRUE),
              answer(text = "Test de student"),
              answer(text = "Chi^2"),
              answer(text = "Test post-hoc"),
              answer("Aucune des réponses proposées"),
              random_answer_order = TRUE),
     question("Combien d'observation compte cette analyse ?",
              answer(text = "Aucune des réponses proposées", 
                     correct = TRUE),
              answer(text = "2"),
              answer(text = "97"),
              answer(text = "99"),
              answer(text = "3"),
              random_answer_order = TRUE))
```

## Choix d'un test statistique

```{r pearson}
question("Sélectionnez les tests statistiques qui permettent de vérifier la corrélation entre 2 variables",
         answer("test de Bartlett"),
         answer("test de Shapiro-wilk"),
         answer("test de Friedman"),
         answer("test de Pearson", correct = TRUE),
         answer("Aucune des réponses proposées"),
         random_answer_order = TRUE)
```

## Réalisation de graphique

vous avez à votre dispositon les snippets suivants:

```{r, echo = TRUE, eval = FALSE}
## Charts ###############################################################################################
# ...charts
# ..c


## Charts: Add ##########################################################################################
# ..charts: add layers or annotations
# .ca

# .caplotly: convert last ggplot2 into interactive chart
	plotly::ggplotly()

# .caylab: add or change Y label
	${1:CHART} +
		ylab("${2:YOUR Y LABEL HERE}")

# .caxlab: add or change X label
	${1:CHART} +
		xlab("${2:YOUR X LABEL HERE}")

# .catitle: add a plot title
	${1:CHART} +
		ggtitle("${2:YOUR TITLE HERE}")


## Charts: Multivariate #################################################################################
# ..charts: multivariate
# .cm

# .cmcorr: correlation chart
corrplot::corrplot(cor(${1:DF}[, ${2:1:3}], 
                       use = "pairwise.complete.obs"), method = "ellipse")

# .cmxy: multivariate X-Y scatterplot
	GGally::ggscatmat(as.data.frame(${1:DF}), ${2:1:3})


## Charts: Bivariate ####################################################################################
# ..charts: bivariate
# .cb

#.cbhistfact: histogram by factor (facets)
chart(data = ${1:DF}, ~${2:XNUM} %fill=% ${3:XFACTOR} | ${3:XFACTOR}) +
	  geom_histogram(data = select(${1:DF}, -${3:XFACTOR}), fill = "grey", bins = ${4:30}) +
	  geom_histogram(bins = ${4:30}, show.legend = FALSE)

# .cberrbar2: error bars by two factors
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR1} %col=% ${4:XFACTOR2}) +
  geom_jitter(alpha = 0.4, position = position_dodge(0.4)) +
  stat_summary(geom = "point", fun.y = "mean", position = position_dodge(0.4)) +
  stat_summary(geom = "errorbar", width = 0.1, position = position_dodge(0.4),
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

#.cberrbar: error bars by factor
chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
  geom_jitter(alpha = 0.4, width = 0.2) +
  stat_summary(geom = "point", fun.y = "mean") +
  stat_summary(geom = "errorbar", width = 0.1,
               fun.data = "mean_cl_normal", fun.args = list(conf.int = 0.95))

# .cbviolin: violinplot by factor
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
		geom_violin()

# .cbbox: boxplot by factor
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XFACTOR}) +
		geom_boxplot()

# .cbxy: X-Y scatterplot
	chart(data = ${1:DF}, ${2:YNUM} ~ ${3:XNUM}) +
		geom_point()
```

```{r}
biom <- data_frame(height = 1:100  + rnorm(n = 100, mean = 0, sd = 2), 
                   weight = (height*0.5) + rnorm(n = 100, mean = 0, sd = 2), 
                   zone = rep(c("A", "B"),each = 50 ))

```

```{r}
names(biom)
summary(biom)
```

Réalisez une boite de dispersion sur le jeu de données `biometry`, de la hauteur exprimé en cm (`height`) en fonction de la masse exprimée en gramme (`weight`). Utilisez la couleur pour mettre en avant les deux zones étudiées. Soyez complet

**Attention, vous devez exécuter votre code (`Run Code`) et soumettre votre réponse (`Submet Answer`)**

```{r boxplot, exercise = TRUE, exercise.setup = "chart_prepa"}

```

```{r boxplot-check}
# TODO
chart(data = biom, height ~ weight %fill=% zone) +
  geom_boxplot() +
  labs(y = "Hauteur [cm]", x = "Masse [g]")
```



## Conclusion

Vous venez de terminer votre examen.

Laissez nous vos impressions sur cet outil pédagogique ou expérimentez encore dans la zone ci-dessous. Rappelez-vous que pour placer un commentaire dans une zone de code R, vous devez utilisez un dièse (`#`) devant vos phrases.

```{r comm, exercise=TRUE, exercise.lines = 8}
# Ajout de commentaires 
# ...
```

```{r comm-check}
# Not yet...
```